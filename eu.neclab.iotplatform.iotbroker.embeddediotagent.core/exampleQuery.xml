<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<queryContextRequest>
    <entityIdList>
        <entityId type="Room" isPattern="false">
            <id>ConferenceRoom</id>
        </entityId>
    </entityIdList>
    <restriction>
        <attributeExpression></attributeExpression>
        <scope>
            <operationScope>
                 <scopeType>HistoricalQuery</scopeType>
                <scopeValue>
                	<startTime>yyyy-mm-dd hh:mm:ss</startTime>
                	<endTime>yyyy-mm-dd hh:mm:ss</endTime>
                </scopeValue>
            </operationScope>
            <operationScope>
                 <scopeType>ISO8601TimeInterval</scopeType>
                <scopeValue>yyyy-mm-ddThh:mm:ssZ/yyyy-mm-ddThh:mm:ssZ</scopeValue>
            </operationScope>
        </scope>
    </restriction>
</queryContextRequest>



{
	"entities" : [
		{ "id" : "urn:x-iot:smartsantander:1:10008","isPattern":false,"type":"light" }
	],
	"attributes" : [ "noise"]
}



{
	"entities" : [
		{ "id" : "urn:x-iot:smartsantander:1:10008",
		  "isPattern" : false,
		  "type" : "light"
		}
	],
	"attributes" : [ "noise"],
	"restriction" : {
		"attributeExpression" : "",
		"scopes" : [
			{ 
				"scopeType" : "ISO8601TimeInterval",
				"scopeValue" : "2015-07-24T17:00:00+0200/2015-07-24T17:03:00+0200"
			}
		]
	}
}



{
	"entities" : [
		{ "id" : "urn:x-iot:smartsantander:1:478","isPattern":false}
	],
	"attributes" : [ "temperature","battery","noise"],
"restriction" : {
		"attributeExpression" : "",
		"scopes" : [
			{ 
				"scopeType" : "ISO8601TimeInterval",
				"scopeValue" : "2015-08-18T16:54:00+0200/2015-08-18T16:55:00+0200"
			}
		]
	}
}

{
	"entities" : [
		{ "id" : "urn:x-iot:smartsantander:1:478","isPattern":false}
	],
        "reference" : "http://localhost:8002",
	"attributes" : [ "temperature","battery","noise"],
"restriction" : {
		"attributeExpression" : "",
		"scopes" : [
			{ 
				"scopeType" : "SimpleGeoLocation",
				"scopeValue" : { "nw_Corner" : "5.0,1.0", "se_Corner" : "5.0,1.0"}
			}
		]
	}
}


//http://localhost:8060/ngsi10/updateContext
{
    "updateAction": "UPDATE",
    "contextElements": [{
   "entityId": {
       "id": "urn:x-iot:smartsantander:1:478",
       "isPattern": false
   },
   "domainMetadata": [
       {
           "name": "longitude",
           "type": "longitude",
           "value": "-3.80485"
       },
       {
           "name": "latitude",
           "type": "latitude",
           "value": "43.46276"
       },
       {
           "name": "district",
           "type": "district",
           "value": "1"
       },
       {
           "name": "section",
           "type": "section",
           "value": "002"
       }
   ],
   "attributes": [
       {
           "name": "battery",
           "type": "battery",
           "contextValue": "66.00",
           "metadata": [
               {
                   "name": "date",
                   "type": "date",
                   "value": "2015-08-18 16:54:36"
               }
           ]
       }
   ]
}]
}


//http://localhost:8060/ngsi10/subscribeContext
{
	"entities" : [
		{ "id" : "urn:x-iot:smartsantander:1:478","isPattern":false}
	],
        "reference" : "http://localhost:8004/ngsi10/notify",
	"attributes" : [ "temperature","battery","noise"],
"restriction" : {
		"attributeExpression" : "",
		"scopes" : [
			{ 
				"scopeType" : "SimpleGeoLocation",
				"scopeValue" : { "nw_Corner" : "5.0,1.0", "se_Corner" : "5.0,1.0"}
			}
		]
	}
}

http://localhost:8070/ngsi10/subscribeContext
<?xml version="1.0" encoding="UTF-8"?><subscribeContextRequest>
  <entityIdList>
    <entityId type="room" isPattern="true">
      <id>.*</id>
    </entityId>
    <entityId type="room" isPattern="false">
      <id>ConferenceRoom</id>
    </entityId>
  </entityIdList>
  <attributeList>
    <attribute>noise</attribute>
    <attribute>temperature</attribute>
  </attributeList>
  <reference>http://localhost:8002/</reference>
  <restriction>
    <attributeExpression>//noise</attributeExpression>
    <scope>
      <operationScope>
        <scopeType>timestamp</scopeType>
        <scopeValue>now</scopeValue>
      </operationScope>
    </scope>
  </restriction>
  <notifyConditions>
    <notifyCondition>
      <type>ONVALUE</type>
      <restriction>
        <attributeExpression>//noise</attributeExpression>
        <scope>
          <operationScope>
            <scopeType>timestamp</scopeType>
            <scopeValue>now</scopeValue>
          </operationScope>
        </scope>
      </restriction>
    </notifyCondition>
  </notifyConditions>
</subscribeContextRequest>

http://localhost:8070/ngsi10/subscribeContext
{
    "entities": [{
        "isPattern": true,
        "id": ".*",
        "type": "room"
    }, {
        "isPattern": false,
        "id": "ConferenceRoom",
        "type": "room"
    }],
    "attributes": ["noise", "temperature"],
    "reference": "http://localhost:8002/",
    "restriction": {
        "scopes": [{
            "scopeType": "timestamp",
            "scopeValue": "now"
        }],
        "attributeExpression": "//noise"
    },
    "notifyCondition": [{
        "restriction": {
            "scopes": [{
                "scopeType": "timestamp",
                "scopeValue": "now"
            }],
            "attributeExpression": "//noise"
        },
        "type": "ONVALUE"
    }]
}


/********************
/********************
/********************
// Example TESTS: UpdateContext vs SubscribeContext with NotifyCondition.ONVALUE
/********************
/********************
http://localhost:8070/ngsi10/subscribeContext
{
    "entities": [{
        "isPattern": true,
        "id": ".*"
    }],
    "attributes": ["noise", "temperature"],
    "reference": "http://localhost:8004/ngsi10/notify",
    "notifyCondition": [{
        "restriction": {
            "attributeExpression": "//contextAttribute[name='noise'][contextValue>68]"
        },
        "type": "ONVALUE"
    }]
}

//http://localhost:8070/ngsi10/updateContext
{
    "updateAction": "UPDATE",
    "contextElements": [{
   "entityId": {
       "id": "urn:x-iot:smartsantander:1:478",
       "isPattern": false
   },
   "domainMetadata": [
       {
           "name": "longitude",
           "type": "longitude",
           "value": "-3.80485"
       },
       {
           "name": "latitude",
           "type": "latitude",
           "value": "43.46276"
       },
       {
           "name": "district",
           "type": "district",
           "value": "1"
       },
       {
           "name": "section",
           "type": "section",
           "value": "002"
       }
   ],
   "attributes": [
       {
           "name": "noise",
           "type": "noise",
           "contextValue": "68.50",
           "metadata": [
               {
                   "name": "date",
                   "type": "date",
                   "value": "2015-08-18 16:54:36"
               }
           ]
       }
   ]
}]
}

//Expected notitification
{
    "subscriptionId": "2420f-aAb82-7F308-85466-4309a-d788929264a06113e2c",
    "contextResponses": [{
        "contextElement": {
            "entityId": {
                "id": "urn:x-iot:smartsantander:1:478",
                "isPattern": false
            },
            "domainMetadata": [{
                "name": "longitude",
                "type": "longitude",
                "value": "-3.80485"
            }, {
                "name": "latitude",
                "type": "latitude",
                "value": "43.46276"
            }, {
                "name": "district",
                "type": "district",
                "value": "1"
            }, {
                "name": "section",
                "type": "section",
                "value": "002"
            }],
            "attributes": [{
                "name": "noise",
                "type": "noise",
                "contextValue": "68.50",
                "metadata": [{
                    "name": "date",
                    "type": "date",
                    "value": "2015-08-18 16:54:36"
                }]
            }]
        },
        "statusCode": {
            "code": 200,
            "reasonPhrase": "OK",
            "details": "New ContextElement"
        }
    }]
}

//http://localhost:8070/ngsi10/updateContext
{
    "updateAction": "UPDATE",
    "contextElements": [{
   "entityId": {
       "id": "urn:x-iot:smartsantander:1:478",
       "isPattern": false
   },
   "domainMetadata": [
       {
           "name": "longitude",
           "type": "longitude",
           "value": "-3.80485"
       },
       {
           "name": "latitude",
           "type": "latitude",
           "value": "43.46276"
       },
       {
           "name": "district",
           "type": "district",
           "value": "1"
       },
       {
           "name": "section",
           "type": "section",
           "value": "002"
       }
   ],
   "attributes": [
       {
           "name": "noise",
           "type": "noise",
           "contextValue": "68.50",
           "metadata": [
               {
                   "name": "date",
                   "type": "date",
                   "value": "2015-08-18 16:54:36"
               }
           ]
       }, {
           "name": "temperature",
           "type": "temperature",
           "contextValue": "68.50",
           "metadata": [
               {
                   "name": "date",
                   "type": "date",
                   "value": "2015-08-18 16:54:36"
               }
           ]
       }
   ]
}]
}

//Expected notitification
{
    "subscriptionId": "2420f-aAb82-7F308-85466-4309a-d788929264a06113e2c",
    "contextResponses": [{
        "contextElement": {
            "entityId": {
                "id": "urn:x-iot:smartsantander:1:478",
                "isPattern": false
            },
            "domainMetadata": [{
                "name": "longitude",
                "type": "longitude",
                "value": "-3.80485"
            }, {
                "name": "latitude",
                "type": "latitude",
                "value": "43.46276"
            }, {
                "name": "district",
                "type": "district",
                "value": "1"
            }, {
                "name": "section",
                "type": "section",
                "value": "002"
            }],
            "attributes": [{
                "name": "noise",
                "type": "noise",
                "contextValue": "68.50",
                "metadata": [{
                    "name": "date",
                    "type": "date",
                    "value": "2015-08-18 16:54:36"
                }]
            }]
        },
        "statusCode": {
            "code": 200,
            "reasonPhrase": "OK",
            "details": "New ContextElement"
        }
    }]
}

/********************
/********************


/********************
/********************
/********************
// Example TESTS: UpdateContext vs SubscribeContext with NotifyCondition.ONVALUE
/********************
/********************
{
    "entities": [{
        "isPattern": true,
        "id": ".*"
    }],
    "attributes": ["noise", "temperature"],
    "reference": "http://localhost:8004/ngsi10/notify",
    "notifyCondition": [{
        "restriction": {
            "attributeExpression": "//contextAttribute[name='noise'][contextValue>68]|//contextAttribute[name='temperature'][contextValue>35]"
        },
        "type": "ONVALUE"
    }]
}



{
    "updateAction": "UPDATE",
    "contextElements": [{
   "entityId": {
       "id": "urn:x-iot:smartsantander:1:478",
       "isPattern": false
   },
   "domainMetadata": [
       {
           "name": "longitude",
           "type": "longitude",
           "value": "-3.80485"
       },
       {
           "name": "latitude",
           "type": "latitude",
           "value": "43.46276"
       },
       {
           "name": "district",
           "type": "district",
           "value": "1"
       },
       {
           "name": "section",
           "type": "section",
           "value": "002"
       }
   ],
   "attributes": [
       {
           "name": "noise",
           "type": "noise",
           "contextValue": "58.50",
           "metadata": [
               {
                   "name": "date",
                   "type": "date",
                   "value": "2015-08-18 16:54:36"
               }
           ]
       }, {
           "name": "temperature",
           "type": "temperature",
           "contextValue": "20",
           "metadata": [
               {
                   "name": "date",
                   "type": "date",
                   "value": "2015-08-18 16:54:36"
               }
           ]
       }
   ]
}]
}

/********************
/********************